---
title: Logs
description: Configure event-to-log transformations
author: zoobzio
published: 2025-12-11
updated: 2025-12-11
tags:
  - Guide
  - Logs
---

# Logs Guide

Transform capitan events into OTEL logs.

## Default Behavior

With no log configuration, all events are logged:

```go
// No log config = log everything
config := &aperture.Config{
    Metrics: []aperture.MetricConfig{...},
    // Logs: nil - all events logged
}

ap, _ := aperture.New(cap, logProvider, meterProvider, traceProvider, config)

sig1 := capitan.NewSignal("order.created", "Order created")
sig2 := capitan.NewSignal("order.shipped", "Order shipped")

cap.Emit(ctx, sig1)  // Logged
cap.Emit(ctx, sig2)  // Logged
```

## Whitelist Filtering

Log only specific signals:

```go
orderCreated := capitan.NewSignal("order.created", "Order created")
orderFailed := capitan.NewSignal("order.failed", "Order failed")
orderShipped := capitan.NewSignal("order.shipped", "Order shipped")

config := &aperture.Config{
    Logs: &aperture.LogConfig{
        Whitelist: []capitan.Signal{
            orderCreated,
            orderFailed,
        },
    },
}

cap.Emit(ctx, orderCreated)  // Logged
cap.Emit(ctx, orderFailed)   // Logged
cap.Emit(ctx, orderShipped)  // NOT logged (not in whitelist)
```

## Log Attributes

Event fields become log attributes:

```go
orderCreated := capitan.NewSignal("order.created", "Order created")
orderID := capitan.NewStringKey("order_id")
total := capitan.NewFloat64Key("total")
items := capitan.NewIntKey("items")

cap.Emit(ctx, orderCreated,
    orderID.Field("ORD-123"),
    total.Field(99.99),
    items.Field(3),
)
```

Produces log record with attributes:
```
signal="order.created"
order_id="ORD-123"
total=99.99
items=3
```

## Signal Metadata

Every log record includes standard attributes:

| Attribute | Source | Description |
|-----------|--------|-------------|
| `capitan.signal` | `Event.Signal()` | Signal name |
| `capitan.signal.description` | Signal description | Signal description |
| Timestamp | `Event.Timestamp()` | Event timestamp |
| Severity | `Event.Severity()` | Capitan severity level |

## Severity Mapping

Capitan severity maps to OTEL log severity:

| Capitan | OTEL |
|---------|------|
| `Debug` | `DEBUG` |
| `Info` | `INFO` |
| `Warn` | `WARN` |
| `Error` | `ERROR` |
| `Fatal` | `FATAL` |

## Context Extraction for Logs

Add context values as log attributes:

```go
type ctxKey string
const (
    userIDKey  ctxKey = "user_id"
    requestKey ctxKey = "request_id"
)

config := &aperture.Config{
    ContextExtraction: &aperture.ContextExtractionConfig{
        Logs: []aperture.ContextKey{
            {Key: userIDKey, Name: "user_id"},
            {Key: requestKey, Name: "request_id"},
        },
    },
}

ctx = context.WithValue(ctx, userIDKey, "user-123")
ctx = context.WithValue(ctx, requestKey, "req-456")

cap.Emit(ctx, sig)
// Log includes: user_id="user-123", request_id="req-456"
```

## Stdout Logging

Enable console logging alongside OTEL:

```go
config := &aperture.Config{
    StdoutLogging: true,
}

cap.Emit(ctx, sig)
// Logs to both OTEL and stdout
```

Output format:
```
time=2025-01-15T10:30:00-08:00 level=INFO msg="Order created" signal=order.created order_id=ORD-123
```

## Custom Type Transformation

Register transformers for custom types:

```go
type OrderInfo struct {
    ID     string
    Total  float64
    Secret string  // Don't log
}

orderVariant := capitan.Variant("myapp.OrderInfo")
orderKey := capitan.NewKey[OrderInfo]("order", orderVariant)

config := &aperture.Config{
    Transformers: map[capitan.Variant]aperture.FieldTransformer{
        orderVariant: aperture.MakeTransformer(func(key string, order OrderInfo) []log.KeyValue {
            return []log.KeyValue{
                log.String(key+".id", order.ID),
                log.Float64(key+".total", order.Total),
                // Secret intentionally omitted
            }
        }),
    },
}

cap.Emit(ctx, sig, orderKey.Field(OrderInfo{ID: "ORD-123", Total: 99.99, Secret: "xxx"}))
// Log includes: order.id="ORD-123", order.total=99.99
// Secret not logged
```

## Using Logger Directly

Access the underlying OTEL logger:

```go
logger := ap.Logger("orders")

// Direct log emission
var record log.Record
record.SetBody(log.StringValue("Direct log message"))
record.SetSeverity(log.SeverityInfo)
record.AddAttributes(log.String("order_id", "ORD-123"))

logger.Emit(ctx, record)
```

## Built-in Field Types

All capitan field types are transformed:

| Capitan Type | Log Attribute |
|--------------|---------------|
| `string` | `log.String(key, value)` |
| `int`, `int32`, `int64` | `log.Int64(key, value)` |
| `uint`, `uint32`, `uint64` | `log.Int64(key, value)` |
| `float32`, `float64` | `log.Float64(key, value)` |
| `bool` | `log.Bool(key, value)` |
| `time.Time` | `log.Int64(key, unix)` |
| `time.Duration` | `log.Int64(key, nanos)` |
| `[]byte` | `log.Bytes(key, value)` |
| `error` | `log.String(key, err.Error())` |

## Schema Configuration

Via YAML:

```yaml
logs:
  whitelist:
    - OrderCreated
    - OrderFailed
    - PaymentFailed

stdout: true
```

Load with registry:

```go
registry := aperture.NewRegistry()
registry.Register(OrderCreated, OrderFailed, PaymentFailed)

schema, _ := aperture.LoadSchemaFromFile("config.yaml")
config, _ := registry.Build(schema)
```

## Performance Considerations

- Whitelist filtering happens before transformation (fast path for filtered events)
- Field transformation is lazy (only when logging)
- Stdout logging adds overhead; disable in production if not needed
