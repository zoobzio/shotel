---
title: Concepts
description: Core concepts and mental model
author: zoobzio
published: 2025-12-11
updated: 2025-12-11
tags:
  - Learn
  - Concepts
---

# Concepts

## The Bridge Model

Aperture bridges two systems:

**Capitan** - In-process event coordination. Signals, fields, observers.

**OpenTelemetry** - Vendor-neutral observability. Logs, metrics, traces.

```
┌─────────────────┐          ┌─────────────────┐
│     Capitan     │          │  OpenTelemetry  │
│                 │          │                 │
│  Signals        │──────────│  Logs           │
│  Fields         │  Aperture│  Metrics        │
│  Events         │──────────│  Traces         │
│                 │          │                 │
└─────────────────┘          └─────────────────┘
```

## Configuration vs Providers

Two separate concerns:

### Provider Configuration (Your Responsibility)

How OTEL talks to backends:

```go
// Exporter: where data goes
exporter, _ := otlptracehttp.New(ctx, otlptracehttp.WithEndpoint("jaeger:4318"))

// Provider: how it's processed
traceProvider := trace.NewTracerProvider(
    trace.WithSpanProcessor(trace.NewBatchSpanProcessor(exporter)),
    trace.WithSampler(trace.TraceIDRatioBased(0.1)),
    trace.WithResource(myResource),
)
```

### Aperture Configuration (Transformation Rules)

How events become signals:

```go
config := &aperture.Config{
    Metrics: []aperture.MetricConfig{...},
    Traces:  []aperture.TraceConfig{...},
    Logs:    &aperture.LogConfig{...},
}
```

## Field Transformation

Capitan fields become OTEL attributes. This happens automatically for built-in types:

```go
orderID := capitan.NewStringKey("order_id")
total := capitan.NewFloat64Key("total")

cap.Emit(ctx, sig, orderID.Field("ORD-123"), total.Field(99.99))
```

Becomes:

```
log.String("order_id", "ORD-123")
log.Float64("total", 99.99)
```

### Custom Types

Register transformers for custom types:

```go
type OrderInfo struct {
    ID     string
    Total  float64
    Secret string
}

config := &aperture.Config{
    Transformers: map[capitan.Variant]aperture.FieldTransformer{
        orderVariant: aperture.MakeTransformer(func(key string, order OrderInfo) []log.KeyValue {
            return []log.KeyValue{
                log.String(key+".id", order.ID),
                log.Float64(key+".total", order.Total),
                // Secret intentionally omitted
            }
        }),
    },
}
```

## Signal Types

### Logs

Events become log records. By default, all events are logged. Use a whitelist to filter:

```go
config := &aperture.Config{
    Logs: &aperture.LogConfig{
        Whitelist: []capitan.Signal{sig1, sig2}, // Only these are logged
    },
}
```

### Metrics

Signals trigger metric operations. Four instrument types:

| Type | Use Case | Value Source |
|------|----------|--------------|
| Counter | Count occurrences | Event emission |
| Gauge | Current value | Field value |
| Histogram | Distribution | Field value |
| UpDownCounter | Bidirectional count | Field value |

```go
config := &aperture.Config{
    Metrics: []aperture.MetricConfig{
        {Signal: orderCreated, Name: "orders_total", Type: aperture.MetricTypeCounter},
        {Signal: cpuUsage, Name: "cpu_percent", Type: aperture.MetricTypeGauge, ValueKey: percentKey},
    },
}
```

### Traces

Signal pairs become spans. Start and end events correlate by a key value:

```go
config := &aperture.Config{
    Traces: []aperture.TraceConfig{
        {
            Start:          reqStarted,
            End:            reqCompleted,
            CorrelationKey: &requestID,
            SpanName:       "http_request",
        },
    },
}

// Events correlate by request_id value
cap.Emit(ctx, reqStarted, requestID.Field("REQ-123"))
cap.Emit(ctx, reqCompleted, requestID.Field("REQ-123"))  // Completes span
```

## Context Extraction

Pull values from `context.Context` into attributes:

```go
type ctxKey string
const userIDKey ctxKey = "user_id"

config := &aperture.Config{
    ContextExtraction: &aperture.ContextExtractionConfig{
        Logs: []aperture.ContextKey{
            {Key: userIDKey, Name: "user_id"},
        },
    },
}

ctx = context.WithValue(ctx, userIDKey, "user-123")
cap.Emit(ctx, sig)
// ^ Log includes user_id="user-123" attribute
```

## Schema-Based Configuration

Load configuration from files instead of code:

```yaml
# observability.yaml
metrics:
  - signal: OrderCreated
    name: orders_total
    type: counter

logs:
  whitelist:
    - OrderCreated
```

```go
configBytes, _ := os.ReadFile("observability.yaml")
schema, _ := aperture.LoadSchemaFromYAML(configBytes)
config, _ := registry.Build(schema)
```

Enables hot-reload without recompilation.

## Lifecycle

1. **Create providers** - Configure OTEL exporters and processors
2. **Create aperture** - Pass providers and configuration
3. **Emit events** - Capitan events automatically transform
4. **Close aperture** - Stop observing (does NOT shutdown providers)
5. **Shutdown providers** - Your responsibility

```go
// 1. Providers
logProvider := log.NewLoggerProvider(...)
defer logProvider.Shutdown(ctx)  // 5. Your shutdown

// 2. Aperture
ap, _ := aperture.New(cap, logProvider, meterProvider, traceProvider, config)
defer ap.Close()  // 4. Stop observing

// 3. Events
cap.Emit(ctx, sig, fields...)
```

## Next Steps

- [Architecture](3.architecture.md) - Implementation details
- [Metrics Guide](../3.guides/1.metrics.md) - Deep dive on metrics
- [Traces Guide](../3.guides/2.traces.md) - Deep dive on traces
