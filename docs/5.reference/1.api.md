---
title: API Reference
description: Complete API documentation
author: zoobzio
published: 2025-12-11
updated: 2025-12-11
tags:
  - Reference
  - API
---

# API Reference

## Aperture

### Constructor

```go
func New(
    c *capitan.Capitan,
    logProvider log.LoggerProvider,
    meterProvider metric.MeterProvider,
    traceProvider trace.TracerProvider,
    config *Config,
) (*Aperture, error)
```

Creates a new Aperture instance that observes all capitan events.

**Parameters:**
- `c` - Capitan instance to observe
- `logProvider` - OTEL log provider (required)
- `meterProvider` - OTEL meter provider (required)
- `traceProvider` - OTEL trace provider (required)
- `config` - Transformation configuration (nil = log all events)

**Returns:**
- `*Aperture` - The aperture instance
- `error` - Configuration validation errors

### Methods

#### Logger

```go
func (s *Aperture) Logger(name string) log.Logger
```

Returns an OTEL logger with the given name.

#### Meter

```go
func (s *Aperture) Meter(name string) metric.Meter
```

Returns an OTEL meter with the given name.

#### Tracer

```go
func (s *Aperture) Tracer(name string) trace.Tracer
```

Returns an OTEL tracer with the given name.

#### Close

```go
func (s *Aperture) Close()
```

Stops observing capitan events. Does NOT shutdown providers.

## Config

```go
type Config struct {
    Metrics           []MetricConfig
    Traces            []TraceConfig
    Logs              *LogConfig
    ContextExtraction *ContextExtractionConfig
    Transformers      map[capitan.Variant]FieldTransformer
    StdoutLogging     bool
}
```

### MetricConfig

```go
type MetricConfig struct {
    Signal      capitan.Signal
    Name        string
    Type        MetricType
    ValueKey    capitan.Key
    Description string
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `Signal` | `capitan.Signal` | Yes | Signal to observe |
| `Name` | `string` | Yes | OTEL metric name |
| `Type` | `MetricType` | No | Default: `MetricTypeCounter` |
| `ValueKey` | `capitan.Key` | For non-counters | Field to extract value from |
| `Description` | `string` | No | Metric description |

### MetricType

```go
type MetricType string

const (
    MetricTypeCounter       MetricType = "counter"       // Default
    MetricTypeGauge         MetricType = "gauge"
    MetricTypeHistogram     MetricType = "histogram"
    MetricTypeUpDownCounter MetricType = "updowncounter"
)
```

### TraceConfig

```go
type TraceConfig struct {
    Start          capitan.Signal
    End            capitan.Signal
    CorrelationKey *capitan.StringKey
    SpanName       string
    SpanTimeout    time.Duration
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `Start` | `capitan.Signal` | Yes | Span start signal |
| `End` | `capitan.Signal` | Yes | Span end signal |
| `CorrelationKey` | `*capitan.StringKey` | Yes | String field to match start/end |
| `SpanName` | `string` | No | Defaults to start signal name |
| `SpanTimeout` | `time.Duration` | No | Default: 5 minutes |

### LogConfig

```go
type LogConfig struct {
    Whitelist []capitan.Signal
}
```

| Field | Type | Description |
|-------|------|-------------|
| `Whitelist` | `[]capitan.Signal` | Signals to log (empty = log all) |

### ContextExtractionConfig

```go
type ContextExtractionConfig struct {
    Logs    []ContextKey
    Metrics []ContextKey
    Traces  []ContextKey
}
```

### ContextKey

```go
type ContextKey struct {
    Key  any    // Context key type
    Name string // Attribute name
}
```

## Field Transformers

### FieldTransformer

```go
type FieldTransformer func(f capitan.Field) []log.KeyValue
```

Converts a capitan field to OTEL log attributes. Return nil or empty slice to skip the field.

### TransformerFunc

```go
type TransformerFunc[T any] func(key string, value T) []log.KeyValue
```

Type-safe transformer function signature for use with `MakeTransformer`.

### MakeTransformer

```go
func MakeTransformer[T any](fn TransformerFunc[T]) FieldTransformer
```

Creates a `FieldTransformer` from a type-safe `TransformerFunc`. The returned transformer extracts the typed value from the field and passes it to your function.

**Example:**

```go
transformer := MakeTransformer(func(key string, order OrderInfo) []log.KeyValue {
    return []log.KeyValue{
        log.String(key+".id", order.ID),
        log.Float64(key+".total", order.Total),
    }
})
```

## Providers

```go
type Providers struct {
    Log   *log.LoggerProvider
    Meter *metric.MeterProvider
    Trace *trace.TracerProvider
}
```

### Shutdown

```go
func (p *Providers) Shutdown(ctx context.Context) error
```

Shuts down all providers gracefully.

## Schema

### LoadSchemaFromFile

```go
func LoadSchemaFromFile(path string) (Schema, error)
```

### LoadSchemaFromYAML

```go
func LoadSchemaFromYAML(data []byte) (Schema, error)
```

### LoadSchemaFromJSON

```go
func LoadSchemaFromJSON(data []byte) (Schema, error)
```

### Schema.Validate

```go
func (s Schema) Validate() error
```

Validates schema structure.

## Registry

### NewRegistry

```go
func NewRegistry() *Registry
```

### Register

```go
func (r *Registry) Register(signals ...capitan.Signal)
```

Registers signals by name.

### RegisterKey

```go
func (r *Registry) RegisterKey(keys ...capitan.Key)
```

Registers field keys by name.

### RegisterContextKey

```go
func (r *Registry) RegisterContextKey(name string, key any)
```

Registers a context key for extraction.

### RegisterTransformer

```go
func (r *Registry) RegisterTransformer(variant capitan.Variant, transformer FieldTransformer)
```

Registers a custom field transformer.

### Build

```go
func (r *Registry) Build(schema Schema) (*Config, error)
```

Converts schema to runtime config.

### Spec

```go
func (r *Registry) Spec() Spec
```

Returns registered components for introspection.

### Spec

```go
type Spec struct {
    Signals      []SignalSpec
    Keys         []KeySpec
    ContextKeys  []string
    Transformers []capitan.Variant
}

type SignalSpec struct {
    Name        string
    Description string
}

type KeySpec struct {
    Name    string
    Variant capitan.Variant
}
```
